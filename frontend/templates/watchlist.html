{% extends "base.html" %}

{% block title %}Watchlist - CineSense{% endblock %}

{% block content %}
<script>
// Prevent infinite loop on image error
function handleImageError(img) {
    if (!img.dataset.errorHandled) {
        img.dataset.errorHandled = 'true';
        img.src = '/static/default_poster.png';
    }
}
</script>
<div class="dashboard">
    <div class="dashboard-header">
        <h1>❤️ Your Watchlist</h1>
        <p>Movies you want to watch</p>
    </div>

    {% if watchlist %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin-top: 30px;">
        {% for movie in watchlist %}
        <div class="movie-card">
            <img src="{{ movie.poster }}" alt="{{ movie.title }}" onerror="handleImageError(this)">
            <div class="overlay">
                <h4>{{ movie.title }}</h4>
                <button onclick="removeFromWatchlist('{{ movie.title }}')" style="margin-top: 10px; background: #e50914; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: 600; width: 100%; transition: 0.3s;">
                    Remove
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; margin-top: 80px;">
        <p style="font-size: 20px; opacity: 0.7; margin-bottom: 20px;">Your watchlist is empty</p>
        <a href="/dashboard" style="background: #e50914; color: white; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-block; transition: 0.3s;">
            Browse Movies
        </a>
    </div>
    {% endif %}
</div>

<script>
function removeFromWatchlist(title) {
    if (confirm('Remove "' + title + '" from watchlist?')) {
        fetch('/remove_from_watchlist', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({title: title})
        })
        .then(r => r.json())
        .then(data => {
            if (data.status === 'success') {
                location.reload();
            } else {
                alert(data.message);
            }
        });
    }
}
</script>
{% endblock %}